<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SARA AI Voice Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
:root {
  /* Vibrant yet professional background colors */
  --primary-bg: #f8fafc;
  --secondary-bg: #f1f5f9;
  
  /* Modern gradient (vibrant teal to deep blue) */
  --accent-gradient: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
  
  /* Alternative gradients */
  --gemini-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --xbox-gradient: linear-gradient(135deg, #11998e, #38ef7d);
  
  /* Enhanced glassmorphism */
  --glass-bg: rgba(255, 255, 255, 0.94);
  --glass-border: rgba(255, 255, 255, 0.2);
  
  /* Text with better contrast */
  --text-primary: #0f172a;   /* deep navy */
  --text-secondary: #475569; /* slate blue-gray */
  
  /* Improved shadows with depth */
  --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
  --shadow-elevation: 0 12px 40px rgba(0, 107, 179, 0.15);
  
  /* Borders */
  --border-light: rgba(0, 0, 0, 0.06);
  
  /* Vibrant semantic colors */
  --success-color: #10b981;  /* emerald green */
  --error-color: #ef4444;    /* vibrant red */
  --warning-color: #f59e0b;  /* amber */
  --info-color: #3b82f6;     /* bright blue */
  
  /* New accent colors */
  --accent-primary: #0083b0;
  --accent-secondary: #00b4db;
  --highlight-color: #e0f2fe;
}

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--primary-bg);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-primary);
      height: 100vh;
      overflow: hidden;
      position: relative;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Background elements */
    .background-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 0;
    }

    .floating-orb {
      position: absolute;
      border-radius: 50%;
      background: linear-gradient(45deg, rgba(66, 133, 244, 0.05), rgba(52, 168, 83, 0.05));
      animation: float 25s ease-in-out infinite;
    }

    .orb-1 {
      width: 400px;
      height: 400px;
      top: -10%;
      right: -10%;
      animation-delay: 0s;
    }

    .orb-2 {
      width: 300px;
      height: 300px;
      bottom: -10%;
      left: -10%;
      animation-delay: -8s;
    }

    .orb-3 {
      width: 200px;
      height: 200px;
      top: 50%;
      left: 70%;
      animation-delay: -15s;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) translateX(0); opacity: 0.3; }
      25% { transform: translateY(-20px) translateX(10px); opacity: 0.5; }
      50% { transform: translateY(-40px) translateX(-10px); opacity: 0.2; }
      75% { transform: translateY(-20px) translateX(5px); opacity: 0.4; }
    }

    .mesh-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 85% 15%, rgba(66, 133, 244, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 15% 85%, rgba(52, 168, 83, 0.03) 0%, transparent 50%);
      z-index: 1;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px 40px;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid var(--border-light);
      box-shadow: var(--shadow-soft);
      z-index: 100;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
    }

    .gemini-logo {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: var(--xbox-gradient);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 24px;
      box-shadow: 0 6px 20px rgba(16, 124, 16, 0.3);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .logo-icon:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(16, 124, 16, 0.4);
    }

    .gemini-title {
      font-size: 32px;
      font-weight: 700;
      background: var(--xbox-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.8px;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      background: rgba(52, 168, 83, 0.1);
      border-radius: 20px;
      border: 1px solid rgba(52, 168, 83, 0.2);
    }

    .status-dot {
      width: 10px;
      height: 10px;
      background: var(--success-color);
      border-radius: 50%;
      animation: pulse-glow 2s infinite;
      box-shadow: 0 0 10px rgba(52, 168, 83, 0.5);
    }

    @keyframes pulse-glow {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.2); }
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 80px;
      left: 0;
      bottom: 0;
      width: 240px;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--border-light);
      z-index: 99;
      padding: 20px 0;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 20px;
      color: var(--text-primary);
      background: var(--xbox-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .new-chat-btn {
      width: 80%;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      background: var(--xbox-gradient);
      border: none;
      color: white;
      border-radius: 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(16, 124, 16, 0.3);
    }

    .new-chat-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 124, 16, 0.4);
    }

    .conversation-list {
      padding: 0 20px;
    }

    .conversation-item {
      padding: 12px 16px;
      border-radius: 18px;
      cursor: pointer;
      margin-bottom: 10px;
      background: rgba(0, 0, 0, 0.03);
      transition: all 0.3s;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .conversation-item:hover {
      background: rgba(0, 0, 0, 0.07);
    }

    .conversation-item i {
      color: var(--info-color);
    }

    /* Chat Container */
    #chat-container {
      position: absolute;
      top: 100px;
      bottom: 180px;
      left: 280px;
      right: 40px;
      max-width: 1000px;
      margin: 0 auto;
      overflow-y: auto;
      padding: 40px 20px;
      z-index: 10;
      scroll-behavior: smooth;
    }

    #chat-container::-webkit-scrollbar {
      width: 8px;
    }

    #chat-container::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
    }

    #chat-container::-webkit-scrollbar-thumb {
      background: var(--xbox-gradient);
      border-radius: 4px;
    }

    .chat-bubble {
      max-width: 70%;
      padding: 20px 28px;
      margin: 24px 0;
      border-radius: 28px;
      font-size: 16px;
      line-height: 1.7;
      word-wrap: break-word;
      position: relative;
      animation: slideInBounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      backdrop-filter: blur(20px);
      font-weight: 400;
    }

    @keyframes slideInBounce {
      0% { opacity: 0; transform: translateY(40px) scale(0.9); }
      60% { opacity: 1; transform: translateY(-5px) scale(1.02); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .user-bubble {
      background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%);
      color: white;
      align-self: flex-end;
      margin-left: auto;
      border-bottom-right-radius: 8px;
      box-shadow: 0 8px 32px rgba(26, 115, 232, 0.3);
    }

    .bot-bubble {
      background: var(--secondary-bg);
      color: var(--text-primary);
      align-self: flex-start;
      border: 1px solid var(--border-light);
      border-bottom-left-radius: 8px;
      box-shadow: var(--shadow-soft);
    }

    .command-response {
      background: rgba(52, 168, 83, 0.1);
      border-left: 4px solid var(--success-color);
      padding: 15px 20px;
      border-radius: 0 12px 12px 0;
      margin: 15px 0;
      font-size: 14px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .welcome-message {
      border: 2px solid;
      border-image: var(--xbox-gradient) 1;
      border-radius: 28px;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
    }

    /* Typing Indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .typing-dots {
      display: flex;
      gap: 6px;
    }

    .dot {
      width: 8px;
      height: 8px;
      background: var(--xbox-gradient);
      border-radius: 50%;
      animation: typing-bounce 1.6s infinite;
    }

    .dot:nth-child(1) { animation-delay: 0s; }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing-bounce {
      0%, 60%, 100% { transform: translateY(0) scale(1); opacity: 0.7; }
      30% { transform: translateY(-12px) scale(1.2); opacity: 1; }
    }

    /* Voice Panel */
    .voice-panel {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px) saturate(180%);
      border-radius: 40px;
      padding: 24px 36px;
      box-shadow: var(--shadow-elevation);
      border: 1px solid var(--border-light);
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 24px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .voice-panel:hover {
      transform: translateX(-50%) translateY(-4px);
      box-shadow: 0 12px 50px rgba(0, 0, 0, 0.15);
    }

    #mic-btn {
      width: 80px;
      height: 80px;
      background: var(--xbox-gradient);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 32px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 30px rgba(16, 124, 16, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #mic-btn.listening {
      background: linear-gradient(135deg, var(--error-color), var(--warning-color));
      animation: listening-pulse 1.8s ease-in-out infinite;
    }

    @keyframes listening-pulse {
      0%, 100% { box-shadow: 0 8px 30px rgba(234, 67, 53, 0.4); transform: scale(1); }
      50% { box-shadow: 0 8px 40px rgba(234, 67, 53, 0.6), 0 0 0 20px rgba(234, 67, 53, 0.1), 0 0 0 40px rgba(234, 67, 53, 0.05); transform: scale(1.08); }
    }

    .voice-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .voice-status {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 15px;
      letter-spacing: -0.2px;
    }

    .voice-hint {
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 400;
    }

    /* Sound Waves */
    .sound-waves {
      display: flex;
      align-items: center;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.4s;
    }

    .sound-waves.active {
      opacity: 1;
    }

    .wave-bar {
      width: 4px;
      background: var(--xbox-gradient);
      border-radius: 2px;
      animation: wave-dance 1.4s ease-in-out infinite;
    }

    .wave-bar:nth-child(1) { height: 16px; animation-delay: 0s; }
    .wave-bar:nth-child(2) { height: 28px; animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { height: 20px; animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { height: 32px; animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { height: 24px; animation-delay: 0.4s; }
    .wave-bar:nth-child(6) { height: 18px; animation-delay: 0.5s; }

    @keyframes wave-dance {
      0%, 100% { transform: scaleY(0.4); opacity: 0.7; }
      50% { transform: scaleY(1.2); opacity: 1; }
    }

    /* Input Area */
    .input-container {
      position: fixed;
      bottom: 0;
      left: 280px;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border-light);
      display: flex;
      padding: 16px 24px;
      gap: 16px;
      z-index: 100;
      align-items: center;
    }

    #text-input {
      flex: 1;
      padding: 14px 20px;
      border: 1px solid var(--border-light);
      border-radius: 24px;
      font-size: 15px;
      font-family: inherit;
      background: rgba(0, 0, 0, 0.03);
      transition: all 0.3s;
    }

    #text-input:focus {
      outline: none;
      border-color: #107c10;
      box-shadow: 0 0 0 2px rgba(16, 124, 16, 0.2);
      background: white;
    }

    .send-btn {
      padding: 14px 24px;
      border-radius: 24px;
      background: var(--xbox-gradient);
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .send-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(16, 124, 16, 0.4);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      #chat-container {
        left: 40px;
      }
      
      .input-container {
        left: 40px;
      }
      
      .menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 16px 20px;
      }
      
      .gemini-title {
        font-size: 26px;
      }
      
      .logo-icon {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      
      #chat-container {
        left: 20px;
        right: 20px;
        top: 90px;
        bottom: 160px;
        padding: 30px 15px;
      }
      
      .chat-bubble {
        max-width: 85%;
        font-size: 15px;
        padding: 18px 22px;
        border-radius: 24px;
      }
      
      .voice-panel {
        padding: 20px 28px;
        gap: 20px;
        border-radius: 35px;
        bottom: 80px;
      }
      
      #mic-btn {
        width: 70px;
        height: 70px;
        font-size: 28px;
      }
      
      .input-container {
        left: 20px;
        right: 20px;
        padding: 12px 16px;
      }
    }

    @media (max-width: 480px) {
      .header-content {
        gap: 12px;
      }
      
      .status-indicator span {
        display: none;
      }
      
      .chat-bubble {
        max-width: 90%;
        padding: 16px 20px;
      }
      
      .voice-panel {
        padding: 16px 20px;
        gap: 16px;
        width: 90%;
      }
      
      #mic-btn {
        width: 60px;
        height: 60px;
        font-size: 24px;
      }
      
      .voice-info {
        display: none;
      }
    }

    /* Menu Toggle (for mobile) */
    .menu-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 101;
      background: var(--xbox-gradient);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Loading Animation */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="menu-toggle" onclick="toggleSidebar()">
    <i class="bi bi-list"></i>
  </button>

  <!-- Sidebar Navigation -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">Chitti AI </div>
    <button class="new-chat-btn" onclick="startNewChat()">
      <i class="bi bi-plus-lg"></i> New Chat
    </button>
    <div class="conversation-list" id="conversation-list">
      <div class="conversation-item" onclick="loadConversation('General Help')">
        <i class="bi bi-question-circle"></i> General Help
      </div>
      <div class="conversation-item" onclick="loadConversation('Music Commands')">
        <i class="bi bi-music-note-list"></i> Music Commands
      </div>
      <div class="conversation-item" onclick="loadConversation('Browser Control')">
        <i class="bi bi-browser-edge"></i> Browser Control
      </div>
    </div>
  </div>

  <!-- Animated Background -->
  <div class="background-container">
    <div class="floating-orb orb-1"></div>
    <div class="floating-orb orb-2"></div>
    <div class="floating-orb orb-3"></div>
  </div>
  
  <!-- Gradient Overlay -->
  <div class="mesh-overlay"></div>

  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="gemini-logo">
        <div class="chat bot-bubble"></div>
        <div class="gemini-title">Chitti AI </div>
      </div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>Online & Ready</span>
      </div>
    </div>
  </div>

  <!-- Chat Container -->
  <div id="chat-container"></div>

  <!-- Voice Control Panel -->
  <div class="voice-panel">
    <button id="mic-btn" onclick="startRecognition()">
      <i class="bi bi-mic"></i>
    </button>
    <div class="voice-info">
      <div class="voice-status" id="voice-status">Press to speak or use spacebar</div>
      <div class="voice-hint">Powered by advanced voice recognition</div>
    </div>
    <div class="sound-waves" id="sound-waves">
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
      <div class="wave-bar"></div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-container">
    <input type="text" id="text-input" placeholder="Type your message..." onkeypress="handleTextInput(event)">
    <button class="send-btn" onclick="sendTextMessage()">
      <span>Send</span>
      <i class="bi bi-send"></i>
    </button>
  </div>

  <script>
    // DOM Elements
    const chatContainer = document.getElementById("chat-container");
    const micBtn = document.getElementById("mic-btn");
    const voiceStatus = document.getElementById("voice-status");
    const soundWaves = document.getElementById("sound-waves");
    const sidebar = document.getElementById("sidebar");
    const textInput = document.getElementById("text-input");
    
    // State
    let isListening = false;
    let recognition;

    // Initialize with welcome message
    window.addEventListener('load', function() {
      setTimeout(() => {
        addBubble("Hello! I'm Chitti , your AI assistant. How can I help you today?", "bot", true);
      }, 800);
    });

    // Toggle sidebar on mobile
    function toggleSidebar() {
      sidebar.classList.toggle('active');
    }

    // Add chat bubble
    function addBubble(text, sender, isWelcome = false) {
      const wrapper = document.createElement("div");
      wrapper.className = "chat-line";

      const bubble = document.createElement("div");
      bubble.className = `chat-bubble ${sender === "user" ? "user-bubble" : "bot-bubble"}`;
      
      if (isWelcome) {
        bubble.classList.add("welcome-message");
      }
      
      bubble.textContent = text;
      wrapper.appendChild(bubble);
      chatContainer.appendChild(wrapper);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Add command response
    function addCommandResponse(text) {
      const wrapper = document.createElement("div");
      wrapper.className = "chat-line";
      
      const response = document.createElement("div");
      response.className = "command-response";
      response.innerHTML = `
        <i class="bi bi-check-circle-fill" style="color: var(--success-color);"></i>
        <span>${text}</span>
      `;
      
      wrapper.appendChild(response);
      chatContainer.appendChild(wrapper);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Typing indicator
    function addTypingIndicator() {
      const wrapper = document.createElement("div");
      wrapper.className = "chat-line";
      wrapper.id = "typing-indicator";
      
      const bubble = document.createElement("div");
      bubble.className = "chat-bubble bot-bubble";
      bubble.innerHTML = `
        <div class="typing-indicator">
          <span>Thinking</span>
          <div class="typing-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>
      `;
      
      wrapper.appendChild(bubble);
      chatContainer.appendChild(wrapper);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function removeTypingIndicator() {
      const indicator = document.getElementById("typing-indicator");
      if (indicator) {
        indicator.remove();
      }
    }

    // Voice recognition
    function startRecognition() {
      if (isListening) return stopRecognition();
      
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        addBubble("Speech recognition is not supported in this browser.", "bot");
        return;
      }

      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'en-US';
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onstart = function() {
        isListening = true;
        micBtn.classList.add('listening');
        soundWaves.classList.add('active');
        updateVoiceStatus("Listening... Speak now");
      };

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        addBubble(transcript, "user");
        sendToServer(transcript);
      };

      recognition.onerror = function(event) {
        isListening = false;
        micBtn.classList.remove('listening');
        soundWaves.classList.remove('active');
        updateVoiceStatus("Error occurred. Please try again");
        setTimeout(() => updateVoiceStatus("Press to speak or use spacebar"), 3000);
      };

      recognition.onend = function() {
        isListening = false;
        micBtn.classList.remove('listening');
        soundWaves.classList.remove('active');
        updateVoiceStatus("Press to speak or use spacebar");
      };

      recognition.start();
    }

    function stopRecognition() {
      if (recognition) {
        recognition.stop();
      }
      isListening = false;
      micBtn.classList.remove('listening');
      soundWaves.classList.remove('active');
      updateVoiceStatus("Press to speak or use spacebar");
    }

    function updateVoiceStatus(status) {
      voiceStatus.textContent = status;
    }

    // Send message to server
    function sendToServer(text) {
      addTypingIndicator();
      updateVoiceStatus("Processing your request...");
      
      fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: text })
      })
      .then(response => response.json())
      .then(data => {
        removeTypingIndicator();
        if (data.reply) {
          if (text.toLowerCase().includes("play") || text.toLowerCase().includes("open")) {
            addCommandResponse(data.reply);
          } else {
            addBubble(data.reply, "bot");
          }
        }
        updateVoiceStatus("Press to speak or use spacebar");
      })
      .catch(error => {
        removeTypingIndicator();
        console.error("Error:", error);
        addBubble("I apologize, but I'm experiencing technical difficulties. Please try again.", "bot");
        updateVoiceStatus("Press to speak or use spacebar");
      });
    }

    // Text input handling
    function handleTextInput(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        sendTextMessage();
      }
    }

    function sendTextMessage() {
      const text = textInput.value.trim();
      if (text) {
        addBubble(text, "user");
        sendToServer(text);
        textInput.value = "";
      }
    }

    // Conversation management
    function startNewChat() {
      chatContainer.innerHTML = '';
      addBubble("Hello! I'm SARA, your AI assistant. How can I help you today?", "bot", true);
      sidebar.classList.remove('active');
    }

    function loadConversation(title) {
      chatContainer.innerHTML = '';
      addBubble(`You opened: ${title}`, "bot", true);
      sidebar.classList.remove('active');
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(event) {
      if (event.code === 'Space' && !isListening && event.target === document.body) {
        event.preventDefault();
        startRecognition();
      }
    });

    // Prevent keyboard events from propagating to document when typing
    document.addEventListener('keydown', function(event) {
      if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
        event.stopPropagation();
      }
    });
  </script>
</body>
</html>